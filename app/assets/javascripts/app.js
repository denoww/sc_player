// Generated by CoffeeScript 2.4.1
(function() {
  var app;

  app = angular.module('AnunciosVideos', []);

  app.controller('PrincipalCtrl', [
    '$scope',
    '$http',
    function($s,
    $http) {
      $s.mensagems = {
        index: 0,
        message: {
          tempo: 1000,
          titulo: 'aa',
          mensagem: ''
        },
        getMessage: function() {
          return $http({
            method: 'GET',
            url: '/messages',
            params: {
              index: $s.mensagems.index
            }
          }).then(function(resp) {
            $s.mensagems.index = resp.data.index;
            $s.mensagems.message = resp.data.message;
            $s.interval.clear();
            return $s.interval.start(resp.data.message.tempo);
          },
    function(error) {
            return console.log('Error :$');
          });
        }
      };
      $s.interval = {
        scope: {},
        start: function(time) {},
        // $s.interval.scope = setTimeout(function(){ $s.mensagems.getMessage(); }, time);
        clear: function() {
          clearTimeout($s.interval.scope);
        }
      };
      $s.interval.start($s.mensagems.message.tempo);
      $s.anuncioVideo = {
        index: 0,
        getPlaylist: function(video) {
          $http({
            method: 'GET',
            url: '/playlist'
          }).then(function(resp) {
            $s.anuncioVideo.index++;
            if ($s.anuncioVideo.index > resp.data.playlist_length - 1) {
              $s.anuncioVideo.index = 0;
            }
            video.src = '/video?id=' + $s.anuncioVideo.index;
          },
    function(error) {
            console.log('Error :$');
          });
        }
      };
    }
  ]);

}).call(this);

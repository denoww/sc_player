// Generated by CoffeeScript 2.4.1
(function() {
  var app;

  app = angular.module('publicidade_app', []);

  app.controller('MainCtrl', [
    '$http',
    function($http) {
      var vm;
      vm = this;
      vm.init = function() {
        var video;
        vm.cor = 'black';
        vm.layout = 'layout-2';
        video = document.getElementById('video-player');
        return video.onended = function(event) {
          return vm.anuncioVideo.getPlaylist(video);
        };
      };
      vm.mensagems = {
        index: 0,
        message: {
          tempo: 1000,
          titulo: 'Globally envisioneer tactical web-readiness',
          mensagem: 'Energistically integrate error-free opportunities and alternative applications. Authoritatively repurpose client-centered strategic theme areas via flexible metrics. Globally envisioneer tactical web-readiness via multidisciplinary functionalities. Compellingly plagiarize.'
        },
        getMessage: function() {
          return $http({
            method: 'GET',
            url: '/messages',
            params: {
              index: vm.mensagems.index
            }
          }).then(function(resp) {
            vm.mensagems.index = resp.data.index;
            vm.mensagems.message = resp.data.message;
            vm.interval.clear();
            return vm.interval.start(resp.data.message.tempo);
          },
    function(error) {
            return console.log('Error',
    error);
          });
        }
      };
      vm.interval = {
        scope: {},
        start: function(time) {},
        // vm.interval.scope = setTimeout(function(){ vm.mensagems.getMessage(); }, time);
        clear: function() {
          clearTimeout(vm.interval.scope);
        }
      };
      vm.interval.start(vm.mensagems.message.tempo);
      vm.anuncioVideo = {
        index: 0,
        getPlaylist: function(video) {
          $http({
            method: 'GET',
            url: '/playlist'
          }).then(function(resp) {
            vm.anuncioVideo.index++;
            if (vm.anuncioVideo.index > resp.data.playlist_length - 1) {
              vm.anuncioVideo.index = 0;
            }
            video.src = '/video?id=' + vm.anuncioVideo.index;
          },
    function(error) {
            console.error('Erro:',
    error);
          });
        }
      };
      return vm;
    }
  ]);

}).call(this);
